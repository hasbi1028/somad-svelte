const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DbGenLCA.js","../chunks/Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as z}from"../chunks/C1FmrZbK.js";import"../chunks/Bg9kRutz.js";import"../chunks/69_IOA4Y.js";import{p as J,t as S,c as d,s as n,w as u,aj as E,a as T,ak as U,al as V,r as p,u as o}from"../chunks/BkCx6XBQ.js";import{h as F,s as P}from"../chunks/D7hMwOnl.js";import{i as I}from"../chunks/BujD1wMw.js";import{t as Q,a as R,f as K}from"../chunks/CkRD9fqL.js";import{b as N}from"../chunks/B_0iTO2t.js";import{i as W}from"../chunks/fqoh2bZT.js";import{o as X,a as Y}from"../chunks/HM23sfSb.js";import{p as Z}from"../chunks/DHkEQnsw.js";var aa=Q('<div><h2>Hasil Scan:</h2> <p> </p> <button class="svelte-1rw3pm2">Scan Ulang</button></div>'),ea=Q('<p style="color: red;"> </p>'),ta=Q('<main class="svelte-1rw3pm2"><h1>Attendance QR Code Scanner</h1> <div><label for="eventType">Pilih Jenis Event:</label> <select id="eventType" class="svelte-1rw3pm2"><option>Check In</option><option>Check Out</option><option>Break Out</option><option>Break In</option><option>Duty Start</option><option>Duty End</option></select></div> <div id="qr-reader" style="width: 300px; margin: 20px auto;" class="svelte-1rw3pm2"></div> <!> <!></main>');function _a(q,x){J(x,!1);let l=null,_=E(""),r=E(""),O=!1,v=E("check_in"),C="";function D(a,t){if(a===C){o(r,"QR code yang sama tidak dapat digunakan berurutan. Silakan scan QR code yang berbeda."),console.warn("Duplicate QR code detected:",a);return}C=a,o(_,a),o(r,""),console.log("QR Code discan:",a);let e={};try{a.split(",").forEach(s=>{const[i,c]=s.split(":");i&&c&&(e[i.trim()]=c.trim())}),j(e)}catch(s){console.error("Error saat parsing QR Code:",s),o(r,"Error dalam memproses data QR Code.")}}async function j(a){try{const t=await new Promise(i=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(c=>{i({latitude:c.coords.latitude,longitude:c.coords.longitude})},c=>{console.error("Gagal mendapatkan posisi:",c),i({latitude:null,longitude:null})}):i({latitude:null,longitude:null})}),e={user_id:a.ID,event_type:u(v),event_time:new Date().toISOString(),device_info:navigator.userAgent,device_location:"gerbang",latitude:t.latitude,longitude:t.longitude,ip_address:await(await fetch("https://api.ipify.org?format=text")).text()};console.log("Payload:",e),console.log("Student Data:",a);const s=await Z.collection("attendance_log").create(e);console.log("Attendance log berhasil dibuat:",s),alert("Absensi berhasil dicatat!")}catch(t){console.error("Gagal mencatat attendance:",t),o(r,"Gagal mencatat absensi.")}}async function B(){try{const{Html5QrcodeScanner:a}=await z(async()=>{const{Html5QrcodeScanner:e}=await import("../chunks/DbGenLCA.js");return{Html5QrcodeScanner:e}},__vite__mapDeps([0,1]),import.meta.url),t={fps:10,qrbox:{width:250,height:250}};l=new a("qr-reader",t,!1),l.render(D,e=>{console.error("Error pada scanner:",e),o(r,"Terjadi error pada scanner: "+e)}),O=!0}catch(a){console.error("Gagal inisialisasi scanner:",a),o(r,"Gagal memulai scanner.")}}function H(){l&&l.clear().then(()=>{l.render(D,a=>{console.error("Error pada scanner:",a),o(r,"Terjadi error pada scanner: "+a)})}).catch(a=>{console.error("Gagal merestart scanner:",a),o(r,"Gagal merestart scanner.")})}X(()=>{B()}),Y(()=>{l&&l.clear().catch(a=>{console.error("Error saat membersihkan scanner:",a)})}),W();var m=ta();F(a=>{U.title="Attendance Scanner - Best Practice"});var g=n(d(m),2),f=n(d(g),2);S(()=>{u(v),V(()=>{})});var h=d(f);h.value=(h.__value="check_in")==null?"":"check_in";var b=n(h);b.value=(b.__value="check_out")==null?"":"check_out";var y=n(b);y.value=(y.__value="break_out")==null?"":"break_out";var k=n(y);k.value=(k.__value="break_in")==null?"":"break_in";var w=n(k);w.value=(w.__value="duty_start")==null?"":"duty_start";var A=n(w);A.value=(A.__value="duty_end")==null?"":"duty_end",p(f),p(g);var G=n(g,4);{var $=a=>{var t=aa(),e=n(d(t),2),s=d(e,!0);p(e);var i=n(e,2);p(t),S(()=>P(s,u(_))),K("click",i,H),R(a,t)};I(G,a=>{u(_)&&a($)})}var L=n(G,2);{var M=a=>{var t=ea(),e=d(t,!0);p(t),S(()=>P(e,u(r))),R(a,t)};I(L,a=>{u(r)&&a(M)})}p(m),N(f,()=>u(v),a=>o(v,a)),R(q,m),T()}export{_a as component};
